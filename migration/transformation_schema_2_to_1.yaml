# This file provides specific mappings for metric data between Java 2.x to Java 1.x
# The format should be the same as the otel file_format for schema files.
file_format: 1.1.0
# TODO: Fix URL
schema_url: https://github.com/signalfx/splunk-otel-java/migration/transformation_schema_2_to_1.yaml
versions:
  # Java version 2.0.0 is the new version. The following mappings translate
  # FROM the new/correct/stable names back to the previous names.
  # The names to use when applying attribute renaming are the NEW names.
  # <new_name>: <old_name>
  # We want to translate TO the old names as a migration step
  2.0.0:
    metrics:
      changes:
        #--------------------------------------------------------------
        # Memory metrics
        - rename_metrics:
            jvm.memory.used:               runtime.jvm.memory.used
            jvm.memory.committed:          runtime.jvm.memory.committed
            jvm.memory.limit:              runtime.jvm.memory.max
#            jvm.memory.used_after_last_gc: process.runtime.jvm.memory.usage_after_last_gc
#            jvm.memory.init:               process.runtime.jvm.memory.init  # experimental
        - rename_attributes:
            attribute_map:
              jvm.memory.type: area
              jvm.memory.pool.name: pool
            apply_to_metrics:
              - jvm.memory.used
              - jvm.memory.committed
              - jvm.memory.limit
              - jvm.memory.used_after_last_gc
              - jvm.memory.init

        #--------------------------------------------------------------
        # Garbage collection metrics
        - rename_metrics:
            jvm.gc.duration: process.runtime.jvm.gc.duration
        - rename_attributes:
            attribute_map:
              name: jvm.gc.name
              action: jvm.gc.action
            apply_to_metrics:
              - jvm.gc.duration

        #--------------------------------------------------------------
        # Threads metrics
        - rename_metrics:
            jvm.thread.count: process.runtime.jvm.threads.count
        - rename_attributes:
            attribute_map:
              jvm.thread.daemon: daemon
            apply_to_metrics:
              - jvm.threads.count

        #--------------------------------------------------------------
        # Classes metrics
        - rename_metrics:
#            jvm.class.loaded:   process.runtime.jvm.classes.loaded
            jvm.class.unloaded: runtime.jvm.classes.unloaded
            jvm.class.count:    runtime.jvm.classes.loaded

        #--------------------------------------------------------------
        # CPU metrics
        - rename_metrics:
            jvm.cpu.time:               process.runtime.jvm.cpu.time
            jvm.cpu.recent_utilization: process.runtime.jvm.cpu.recent_utilization
            jvm.system.cpu.utilization: process.runtime.jvm.system.cpu.utilization # experimental
            jvm.system.cpu.load_1m:     process.runtime.jvm.system.cpu.load_1m     # experimental

        #--------------------------------------------------------------
        # Buffer metrics
        - rename_metrics:
            jvm.buffer.memory.usage: runtime.jvm.buffer.memory.used    # experimental
            jvm.buffer.memory.limit: runtime.jvm.buffer.total.capacity # experimental
            jvm.buffer.count:        runtime.jvm.buffer.count          # experimental
        - rename_attributes:
            attribute_map:
              jvm.buffer.pool.name: pool
            apply_to_metrics:
              - jvm.buffer.memory.usage
              - jvm.buffer.memory.limit
              - jvm.buffer.count

        #--------------------------------------------------------------
        # HTTP metrics
        - rename_metrics:
            http.client.request.duration:   http.client.duration
            http.server.request.duration:   http.server.duration
            http.server.request.body.size:  http.server.request.size
            http.server.response.body.size: http.server.response.size
        - rename_attributes:
            attribute_map:
              http.request.method:       http.method
              http.response.status_code: http.status_code
              server.address:            net.peer.name
              server.port:               net.peer.port
              network.protocol.name:     net.protocol.name
              network.protocol.version:  net.protocol.version
            apply_to_metrics:
              - http.client.request.duration
        - rename_attributes:
            attribute_map:
              http.request.method:       http.method
              http.response.status_code: http.status_code
              url.scheme:                http.scheme
              network.protocol.name:     net.protocol.name
              network.protocol.version:  net.protocol.version
              server.address:            net.host.name
              server.port:               net.host.port
            apply_to_metrics:
              - http.server.request.duration
